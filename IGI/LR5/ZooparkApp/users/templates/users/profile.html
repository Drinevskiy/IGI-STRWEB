{% extends "zoopark/base.html" %}
{% load static %}

{% block title %}{{title}}{% endblock %}
{% block style %} 
    <link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock %}
{% block content %}
<h2>Профиль</h2>
<div class="user-card">
    <h3>{{ user.first_name }} {{ user.last_name }}</h3>
    <p>Ник: {{ user.username }}</p>
    <p>Email: {{ user.email }}</p>
    <p>Статус: {% if user.is_superuser %}Админ{% elif user.is_staff %}Сотрудник{% elif not user.is_staff and not user.is_admin %}Посетитель{% endif %}</p>
    <p>Телефон: {{ user.phone }}</p>
</div>
<pre>{{ text_calendar }}</pre>
<p>Часовой пояс: {{user_tz}}</p>
<p>{{today|date:"d/m/Y H:i:s O"}}</p>
<p>UTC:{{utc|date:"d/m/Y H:i:s O"}}</p>
{% if user.is_authenticated and not user.is_superuser and not user.is_staff %}
    <h2>Билеты оплаченные</h2>
    <div class="ticket-cards-container">
        {% for ticket in tickets_paid %}
            <div class="ticket-card">
                <h3>{{ ticket.date }}</h3>
                <ul>
                    {% if ticket.excursion %}<li>Экскурсия</li>{% endif %}
                    {% if ticket.feeding %}<li>Кормление</li>{% endif  %}
                    {% if ticket.photosession %}<li>Фотосессия</li>{% endif %}
                    {% if not ticket.photosession and not ticket.feeding and not ticket.excursion %}<li>Стандартный</li>{% endif %}
                </ul>
                <p>{{ticket.count}} шт.</p>
                <p class="price">{{ ticket.full_cost}} рублей</p>
                <div>
                    <a href="{% url 'zoopark:delete-ticket' ticket.pk%}"><img src="{% static 'media/images/trashbag.png' %}" width="30px" height="30px"/></a>
                </div>
            </div>
        {% endfor %}
    </div>
    {% if paid %}
        <h2>Билеты неоплаченные</h2>
            <div class="ticket-cards-container">
            {% for ticket in tickets_not_paid %}
                <div class="ticket-card">
                    <h3>{{ ticket.date }}</h3>
                    <ul>
                        {% if ticket.excursion %}<li>Экскурсия</li>{% endif %}
                        {% if ticket.feeding %}<li>Кормление</li>{% endif  %}
                        {% if ticket.photosession %}<li>Фотосессия</li>{% endif %}
                        {% if not ticket.photosession and not ticket.feeding and not ticket.excursion %}<li>Стандартный</li>{% endif %}
                    </ul>
                    <form action="{% url 'users:profile' %}" id="count-{{ticket.pk}}" method="POST">
                        {% csrf_token %}
                        <input type="range" value="{{ticket.count}}" min="1" max="10" name="count-{{ticket.pk}}" id="count-{{ticket.pk}}" />
                        <input type="hidden" name="ticket_id" value="{{ ticket.pk }}">
                    </form>
                    <p id="countDisplay-{{ticket.pk}}">{{ticket.count}} шт.</p>
                    <p id="priceId-{{ticket.pk}}" class="price">{{ ticket.full_cost}} рублей</p>
                    <div>
                        <a href="{% url 'zoopark:delete-ticket' ticket.pk %}"><img src="{% static 'media/images/trashbag.png' %}" width="30px" height="30px"/></a>
                        {% comment %} <input form="count-{{ticket.pk}}" type="submit" value="Купить" > {% endcomment %}
                        <input type="image" src="{% static 'media/images/wallet.png' %}" width="30px" height="30px" form="count-{{ticket.pk}}">
                        {% comment %} <img id="wallet-icon-{{ticket.pk}}" src="{% static 'media/images/wallet.png' %}" width="30px" height="30px"/></a> {% endcomment %}
                    </div>
                </div>
                <script>
                    document.querySelectorAll('input[type="range"]').forEach(slider => {
                        const ticketId = slider.id.split('-')[1]; // Получаем уникальный идентификатор из id
                        const display = document.getElementById(`countDisplay-${ticketId}`); // Находим соответствующий параграф
                        const price = document.getElementById(`priceId-${ticketId}`); // Находим соответствующий элемент цены
                        const ticketCost = {{ ticket.cost }}; // Получаем стоимость для данного билета
                        slider.addEventListener('input', function() {
                            display.textContent = `${this.value} шт.`;
                            price.textContent = `${this.value * ticketCost} рублей`;
                        });
                        {% comment %} document.getElementById(`wallet-icon-${ticketId}`).addEventListener('click', function() {
                            document.getElementById(`count-${ticketId}`).submit();
                        }); {% endcomment %}
                    });
                </script>
            {% endfor %}
        </div>
        <a href="{% url 'zoopark:payment' %}"><img src="{% static 'media/images/wallet.png' %}" width="30px" height="30px"/>(все)</a>
    {% endif%}
{% endif %}
{% if user.is_authenticated and user.is_staff and not user.is_superuser %}
    <h2>Животные</h2>
    <table>
        <thead>
            <tr>
                <th>Фото</th>
                <th>Животное</th>
                <th>Описание</th>
                <th>Дата рождения</th>
                <th>Дата поступления</th>
                <th>Вид</th>
                <th>Семейство</th>
                <th>Континент</th>
                <th>Корм</th>
                <th>Суточное потребление корма</th>
                <th>Расписание кормления</th>
                <th>Вольер</th>
                <th>Водоем</th>
                <th>Отопление</th>
                <th>Количество животных</th>
            </tr>
        </thead>
        <tbody>
            {% for item in animals %}
            <tr>
                    <td><img src="{% if item.0.image %}{{ item.0.image.url }}{% else %}{% static 'media/images/no.jpg' %}{% endif %}" width=200px alt="{% static 'images/no.jpg' %}"></td>
                    <td>{{ item.0.name }}</td>
                    <td>{{ item.0.description }}</td>
                    <td>{{ item.0.date_of_birth }}</td>
                    <td>{{ item.0.date_of_receipt }}</td>
                    <td>{{ item.0.type.name }}</td>
                    <td>{{ item.0.family.name }}</td>
                    <td>{{ item.0.family.continent }}</td>
                    <td>{{ item.1|join:", " }}</td>
                    <td>{{ item.0.daily_norm }}</td>
                    <td>{{ item.0.feeding_schedule }}</td>
                    <td>{{ item.0.aviary.name }}</td>
                    <td>{% if item.0.aviary.reservoir %}+{% else %}-{% endif%}</td>
                    <td>{% if item.0.aviary.heating %}+{% else %}-{% endif%}</td>
                    <td>{{ item.2.num_animals }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <script>
        let tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
        if (!tz) {
            tz = "UTC"
        }
        document.cookie = "mytz=" + tz + ";path=/";
    </script>
{% endif %}
{% endblock %}